<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NL Central Division Weather Forecast</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .form-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group select,
        .form-group input {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .get-forecast-btn {
            grid-column: span 3;
            justify-self: center;
            padding: 15px 40px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .get-forecast-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .get-forecast-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2rem;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee;
            border: 2px solid #fcc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #c33;
            text-align: center;
        }

        .forecast-container {
            margin-top: 30px;
        }

        .forecast-header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            text-align: center;
        }

        .forecast-header h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .forecast-header p {
            opacity: 0.9;
        }

        .forecast-table-container {
            padding: 0;
            background: white;
            border-radius: 0 0 15px 15px;
            border: 2px solid #e9ecef;
            border-top: none;
            overflow-x: auto;
        }

        .forecast-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        .forecast-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 12px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            border-bottom: 2px solid #5a6fd8;
        }

        .forecast-table th:first-child {
            text-align: left;
            padding-left: 20px;
        }

        .forecast-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }

        .forecast-table td:first-child {
            text-align: left;
            padding-left: 20px;
            font-weight: 600;
            color: #2c3e50;
            background: #f8f9fa;
            white-space: nowrap;
        }

        .forecast-table tbody tr:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .forecast-table tbody tr:nth-child(even) {
            background: #fdfdfd;
        }

        .forecast-table tbody tr:nth-child(even):hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .temperature-cell {
            font-weight: 700;
            color: #e74c3c;
            font-size: 1.1rem;
        }

        .precipitation-cell {
            color: #3498db;
            font-weight: 600;
        }

        .wind-cell {
            color: #27ae60;
            font-weight: 500;
        }

        .game-status {
            margin: 20px 0;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            border: 2px solid;
        }

        .status-play {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
            color: #155724;
        }

        .status-delay {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-color: #ffc107;
            color: #856404;
        }

        .status-postpone {
            background: linear-gradient(135deg, #f8d7da 0%, #f1aeb5 100%);
            border-color: #dc3545;
            color: #721c24;
        }

        .status-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .conditions-cell {
            font-weight: 500;
            color: #2c3e50;
            max-width: 120px;
            word-wrap: break-word;
        }

        @media (max-width: 768px) {
            .form-section {
                grid-template-columns: 1fr;
            }
            
            .get-forecast-btn {
                grid-column: span 1;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚾ MLB Stadium Weather Forecast</h1>
            <p>Get detailed weather forecasts for upcoming games at any MLB stadium</p>
        </div>

        <div class="form-section">
            <div class="form-group">
                <label for="teamSelect">Select Home Team:</label>
                <select id="teamSelect">
                    <option value="">Choose a team...</option>
                    <optgroup label="American League East">
                        <option value="orioles">Baltimore Orioles</option>
                        <option value="redsox">Boston Red Sox</option>
                        <option value="yankees">New York Yankees</option>
                        <option value="rays">Tampa Bay Rays</option>
                        <option value="bluejays">Toronto Blue Jays</option>
                    </optgroup>
                    <optgroup label="American League Central">
                        <option value="whitesox">Chicago White Sox</option>
                        <option value="guardians">Cleveland Guardians</option>
                        <option value="tigers">Detroit Tigers</option>
                        <option value="royals">Kansas City Royals</option>
                        <option value="twins">Minnesota Twins</option>
                    </optgroup>
                    <optgroup label="American League West">
                        <option value="astros">Houston Astros</option>
                        <option value="angels">Los Angeles Angels</option>
                        <option value="athletics">Oakland Athletics</option>
                        <option value="mariners">Seattle Mariners</option>
                        <option value="rangers">Texas Rangers</option>
                    </optgroup>
                    <optgroup label="National League East">
                        <option value="braves">Atlanta Braves</option>
                        <option value="marlins">Miami Marlins</option>
                        <option value="mets">New York Mets</option>
                        <option value="phillies">Philadelphia Phillies</option>
                        <option value="nationals">Washington Nationals</option>
                    </optgroup>
                    <optgroup label="National League Central">
                        <option value="cubs">Chicago Cubs</option>
                        <option value="reds">Cincinnati Reds</option>
                        <option value="brewers">Milwaukee Brewers</option>
                        <option value="pirates">Pittsburgh Pirates</option>
                        <option value="cardinals">St. Louis Cardinals</option>
                    </optgroup>
                    <optgroup label="National League West">
                        <option value="diamondbacks">Arizona Diamondbacks</option>
                        <option value="rockies">Colorado Rockies</option>
                        <option value="dodgers">Los Angeles Dodgers</option>
                        <option value="padres">San Diego Padres</option>
                        <option value="giants">San Francisco Giants</option>
                    </optgroup>
                </select>
            </div>

            <div class="form-group">
                <label for="gameDate">Game Date:</label>
                <input type="date" id="gameDate">
            </div>

            <div class="form-group">
                <label for="gameTime">Game Start Time:</label>
                <input type="time" id="gameTime">
            </div>

            <button class="get-forecast-btn" onclick="getForecast()">Get Weather Forecast</button>
        </div>

        <div id="forecastResults"></div>
    </div>

    <script>
        // Team coordinates (stadiums)
        const teamLocations = {
            // American League East
            orioles: { name: "Baltimore Orioles", lat: 39.2838, lon: -76.6211, stadium: "Oriole Park at Camden Yards", indoor: false },
            redsox: { name: "Boston Red Sox", lat: 42.3467, lon: -71.0972, stadium: "Fenway Park", indoor: false },
            yankees: { name: "New York Yankees", lat: 40.8296, lon: -73.9262, stadium: "Yankee Stadium", indoor: false },
            rays: { name: "Tampa Bay Rays", lat: 27.7682, lon: -82.6534, stadium: "Tropicana Field", indoor: false },
            bluejays: { name: "Toronto Blue Jays", lat: 43.6414, lon: -79.3894, stadium: "Rogers Centre", indoor: true },
            
            // American League Central
            whitesox: { name: "Chicago White Sox", lat: 41.8300, lon: -87.6338, stadium: "Guaranteed Rate Field", indoor: false },
            guardians: { name: "Cleveland Guardians", lat: 41.4958, lon: -81.6852, stadium: "Progressive Field", indoor: false },
            tigers: { name: "Detroit Tigers", lat: 42.3390, lon: -83.0485, stadium: "Comerica Park", indoor: false },
            royals: { name: "Kansas City Royals", lat: 39.0517, lon: -94.4803, stadium: "Kauffman Stadium", indoor: false },
            twins: { name: "Minnesota Twins", lat: 44.9817, lon: -93.2780, stadium: "Target Field", indoor: false },
            
            // American League West
            astros: { name: "Houston Astros", lat: 29.7570, lon: -95.3551, stadium: "Minute Maid Park", indoor: true },
            angels: { name: "Los Angeles Angels", lat: 33.8003, lon: -117.8827, stadium: "Angel Stadium", indoor: false },
            athletics: { name: "Oakland Athletics", lat: 37.7516, lon: -122.2005, stadium: "Oakland Coliseum", indoor: false },
            mariners: { name: "Seattle Mariners", lat: 47.5914, lon: -122.3326, stadium: "T-Mobile Park", indoor: true },
            rangers: { name: "Texas Rangers", lat: 32.7473, lon: -97.0832, stadium: "Globe Life Field", indoor: true },
            
            // National League East
            braves: { name: "Atlanta Braves", lat: 33.8901, lon: -84.4677, stadium: "Truist Park", indoor: false },
            marlins: { name: "Miami Marlins", lat: 25.7781, lon: -80.2197, stadium: "loanDepot park", indoor: true },
            mets: { name: "New York Mets", lat: 40.7571, lon: -73.8458, stadium: "Citi Field", indoor: false },
            phillies: { name: "Philadelphia Phillies", lat: 39.9056, lon: -75.1664, stadium: "Citizens Bank Park", indoor: false },
            nationals: { name: "Washington Nationals", lat: 38.8730, lon: -77.0074, stadium: "Nationals Park", indoor: false },
            
            // National League Central
            cubs: { name: "Chicago Cubs", lat: 41.9484, lon: -87.6553, stadium: "Wrigley Field", indoor: false },
            reds: { name: "Cincinnati Reds", lat: 39.0979, lon: -84.5069, stadium: "Great American Ball Park", indoor: false },
            brewers: { name: "Milwaukee Brewers", lat: 43.0280, lon: -87.9712, stadium: "American Family Field", indoor: true },
            pirates: { name: "Pittsburgh Pirates", lat: 40.4469, lon: -79.9481, stadium: "PNC Park", indoor: false },
            cardinals: { name: "St. Louis Cardinals", lat: 38.6226, lon: -90.1928, stadium: "Busch Stadium", indoor: false },
            
            // National League West
            diamondbacks: { name: "Arizona Diamondbacks", lat: 33.4453, lon: -112.0667, stadium: "Chase Field", indoor: true },
            rockies: { name: "Colorado Rockies", lat: 39.7559, lon: -104.9942, stadium: "Coors Field", indoor: false },
            dodgers: { name: "Los Angeles Dodgers", lat: 34.0739, lon: -118.2400, stadium: "Dodger Stadium", indoor: false },
            padres: { name: "San Diego Padres", lat: 32.7073, lon: -117.1566, stadium: "Petco Park", indoor: false },
            giants: { name: "San Francisco Giants", lat: 37.7786, lon: -122.3893, stadium: "Oracle Park", indoor: false }
        };

        // Set default date to today
        document.getElementById('gameDate').value = new Date().toISOString().split('T')[0];

        async function getForecast() {
            const team = document.getElementById('teamSelect').value;
            const date = document.getElementById('gameDate').value;
            const time = document.getElementById('gameTime').value;
            const resultsDiv = document.getElementById('forecastResults');

            // Validation
            if (!team || !date || !time) {
                resultsDiv.innerHTML = '<div class="error">Please select a team, date, and time.</div>';
                return;
            }

            // Show loading
            resultsDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Fetching weather data from National Weather Service...</div>
                </div>
            `;

            try {
                const location = teamLocations[team];
                const gameDateTime = new Date(`${date}T${time}`);
                
                // Calculate forecast period (1 hour before to 4 hours after)
                const startTime = new Date(gameDateTime.getTime() - 60 * 60 * 1000); // 1 hour before
                const endTime = new Date(gameDateTime.getTime() + 4 * 60 * 60 * 1000); // 4 hours after

                // Get weather data from NWS API
                const weatherData = await getWeatherData(location.lat, location.lon, startTime, endTime);
                
                displayForecast(weatherData, location, gameDateTime);
                
            } catch (error) {
                console.error('Error fetching weather data:', error);
                resultsDiv.innerHTML = `
                    <div class="error">
                        <strong>Error fetching weather data:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
        }

        async function getWeatherData(lat, lon, startTime, endTime) {
            try {
                // Get the forecast office and grid coordinates
                const pointResponse = await fetch(`https://api.weather.gov/points/${lat},${lon}`);
                if (!pointResponse.ok) {
                    throw new Error(`Failed to get grid coordinates: ${pointResponse.status}`);
                }
                const pointData = await pointResponse.json();
                
                // Get hourly forecast
                const forecastResponse = await fetch(pointData.properties.forecastHourly);
                if (!forecastResponse.ok) {
                    throw new Error(`Failed to get forecast data: ${forecastResponse.status}`);
                }
                const forecastData = await forecastResponse.json();
                
                // Filter forecast for our time range
                const periods = forecastData.properties.periods.filter(period => {
                    const periodTime = new Date(period.startTime);
                    return periodTime >= startTime && periodTime <= endTime;
                });

                return periods.slice(0, 6); // Limit to 6 hours max
                
            } catch (error) {
                throw new Error(`Weather service error: ${error.message}`);
            }
        }

        function displayForecast(periods, location, gameDateTime) {
            const resultsDiv = document.getElementById('forecastResults');
            
            if (!periods || periods.length === 0) {
                resultsDiv.innerHTML = '<div class="error">No forecast data available for the selected time period.</div>';
                return;
            }

            // Analyze game status
            const gameStatus = analyzeGameStatus(periods, gameDateTime, location.indoor);
            
            // Status icons and styling
            const statusConfig = {
                play: { icon: '✅', class: 'status-play' },
                delay: { icon: '⚠️', class: 'status-delay' },
                postpone: { icon: '❌', class: 'status-postpone' },
                unknown: { icon: '❓', class: 'status-delay' }
            };

            const config = statusConfig[gameStatus.status] || statusConfig.unknown;

            let forecastHTML = `
                <div class="forecast-container">
                    <div class="forecast-header">
                        <h2>${location.name} - ${location.stadium}</h2>
                        <p>Game Time: ${gameDateTime.toLocaleString()}</p>
                    </div>
                    
                    <div class="game-status ${config.class}">
                        <div>
                            <span class="status-icon">${config.icon}</span>
                            ${gameStatus.message}
                        </div>
                        <div class="status-details">${gameStatus.details}</div>
                    </div>
                    
                    <div class="forecast-table-container">
                        <table class="forecast-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Temperature</th>
                                    <th>Conditions</th>
                                    <th>Precipitation</th>
                                    <th>Precip Amount</th>
                                    <th>Wind Speed</th>
                                    <th>Wind Direction</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            periods.forEach(period => {
                const periodTime = new Date(period.startTime);
                const timeString = periodTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const dateString = periodTime.toLocaleDateString([], {month: 'short', day: 'numeric'});
                
                // Parse wind direction and speed
                const windMatch = period.windSpeed.match(/(\d+)\s*mph/);
                const windSpeed = windMatch ? windMatch[1] + ' mph' : period.windSpeed;
                const windDirection = period.windDirection || 'Variable';
                
                // Get precipitation info
                const precipitation = period.probabilityOfPrecipitation?.value || 0;
                const precipitationAmount = period.quantitativePrecipitation?.value || 0;
                
                forecastHTML += `
                    <tr>
                        <td>
                            <strong>${timeString}</strong><br>
                            <small style="color: #7f8c8d;">${dateString}</small>
                        </td>
                        <td class="temperature-cell">${period.temperature}°${period.temperatureUnit}</td>
                        <td class="conditions-cell">${period.shortForecast}</td>
                        <td class="precipitation-cell">${precipitation}%</td>
                        <td class="precipitation-cell">${precipitationAmount > 0 ? precipitationAmount.toFixed(2) + ' in' : 'None'}</td>
                        <td class="wind-cell">${windSpeed}</td>
                        <td class="wind-cell">${windDirection}</td>
                    </tr>
                `;
            });

            forecastHTML += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            resultsDiv.innerHTML = forecastHTML;
        }

        // Allow Enter key to trigger forecast
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                getForecast();
            }
        });

        function analyzeGameStatus(periods, gameDateTime, isIndoorStadium) {
            if (!periods || periods.length === 0) {
                return { status: 'unknown', message: 'Unable to determine game status - no weather data available', details: '' };
            }

            // Indoor stadiums are never cancelled due to weather
            if (isIndoorStadium) {
                return { 
                    status: 'play', 
                    message: 'Game will be played as scheduled', 
                    details: 'Indoor stadium - weather does not affect gameplay. Check forecast for conditions outside the stadium.' 
                };
            }

            let maxPrecipProb = 0;
            let totalPrecipAmount = 0;
            let hasThunderstorms = false;
            let minTemp = 999;
            let maxTemp = -999;
            let gameStartConditions = null;

            // Analyze weather conditions
            periods.forEach((period, index) => {
                const periodTime = new Date(period.startTime);
                const precipProb = period.probabilityOfPrecipitation?.value || 0;
                const precipAmount = period.quantitativePrecipitation?.value || 0;
                const temp = period.temperature;
                
                maxPrecipProb = Math.max(maxPrecipProb, precipProb);
                totalPrecipAmount += precipAmount;
                minTemp = Math.min(minTemp, temp);
                maxTemp = Math.max(maxTemp, temp);
                
                // Check for thunderstorms
                if (period.shortForecast.toLowerCase().includes('thunder') || 
                    period.shortForecast.toLowerCase().includes('storm')) {
                    hasThunderstorms = true;
                }
                
                // Game start conditions (first 2 hours are most critical)
                if (index < 2) {
                    if (!gameStartConditions) {
                        gameStartConditions = {
                            precipProb: precipProb,
                            precipAmount: precipAmount,
                            conditions: period.shortForecast
                        };
                    } else {
                        gameStartConditions.precipProb = Math.max(gameStartConditions.precipProb, precipProb);
                        gameStartConditions.precipAmount += precipAmount;
                    }
                }
            });

            // Decision logic for outdoor stadiums
            let status, message, details;

            // Automatic postponement conditions
            if (hasThunderstorms) {
                status = 'postpone';
                message = 'Game will likely be postponed';
                details = 'Thunderstorms present - MLB policy requires postponement for lightning safety';
            }
            else if (minTemp < 35) {
                status = 'postpone';
                message = 'Game will likely be postponed';
                details = `Extremely cold conditions (${minTemp}°F) - player safety concern`;
            }
            else if (maxTemp > 100) {
                status = 'postpone';
                message = 'Game will likely be postponed';
                details = `Extreme heat (${maxTemp}°F) - player safety concern`;
            }
            else if (maxPrecipProb > 70 && totalPrecipAmount > 0.1) {
                status = 'postpone';
                message = 'Game will likely be postponed';
                details = `Heavy rain expected (${maxPrecipProb}% chance, ${totalPrecipAmount.toFixed(2)}" total)`;
            }
            // Possible delay conditions
            else if (gameStartConditions.precipProb > 30 && gameStartConditions.precipAmount > 0.05) {
                status = 'delay';
                message = 'Game may be rain-delayed';
                details = `Moderate rain possible at game start (${gameStartConditions.precipProb}% chance, ${gameStartConditions.precipAmount.toFixed(2)}" expected)`;
            }
            else if (maxPrecipProb > 50 && totalPrecipAmount > 0.05) {
                status = 'delay';
                message = 'Game may be rain-delayed';
                details = `Rain likely during game (${maxPrecipProb}% chance, ${totalPrecipAmount.toFixed(2)}" total)`;
            }
            // Game will be played
            else {
                status = 'play';
                message = 'Game will be played as scheduled';
                if (maxPrecipProb > 0) {
                    details = `Good conditions (${maxPrecipProb}% chance of rain, ${totalPrecipAmount.toFixed(2)}" expected)`;
                } else {
                    details = 'Clear conditions expected';
                }
            }

            return { status, message, details };
        }
    </script>
</body>
</html>
